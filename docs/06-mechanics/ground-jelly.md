# Jelly 果冻

## 概述

Jelly（果冻）是一种 Ground 层级的障碍物，位于 Tile 下方。与冰块相比，果冻需要更多次消除才能清除，增加了关卡的挑战性。

## 基本属性

| 属性 | 值 |
|------|-----|
| GroundType | `Jelly` |
| 默认血量 | 2 HP |
| 层级位置 | Ground（Tile 下方） |

## 规则

### 消除规则

1. **触发条件**：当果冻上方的 Tile 被消除时（匹配、爆炸、UFO、彩球等）
2. **伤害**：每次消除 Tile，果冻 HP - 1
3. **摧毁**：HP 归零时，果冻被移除，发送 `GroundDestroyedEvent`

### 与冰块的区别

| 特性 | Ice 冰块 | Jelly 果冻 |
|------|----------|-----------|
| 默认 HP | 1 | 2 |
| 消除次数 | 1 次 | 2 次 |
| 难度定位 | 基础障碍 | 进阶障碍 |

### 不影响的规则

- **匹配检测**：果冻不影响 Tile 的匹配判定
- **Tile 移动**：果冻不阻挡 Tile 的重力下落
- **玩家交换**：果冻不阻止玩家交换上方的 Tile

```
消除流程（双层果冻示例）：

第一次消除 Tile
    │
    ▼
Jelly.HP-- (2 → 1)
    │
    └──→ HP > 0，果冻保留

第二次消除 Tile
    │
    ▼
Jelly.HP-- (1 → 0)
    │
    └──→ HP = 0，移除果冻
         发送 GroundDestroyedEvent
```

### 多层果冻

通过设置不同的初始血量，可以实现更高难度的果冻：

| 层数 | 初始 HP | 所需消除次数 |
|------|---------|-------------|
| 双层果冻（默认） | 2 | 2 |
| 三层果冻 | 3 | 3 |
| 四层果冻 | 4 | 4 |

## 视觉表现

| 状态 | 描述 |
|------|------|
| HP = 4 | 深色果冻，完全饱和 |
| HP = 3 | 较深颜色，略有透明 |
| HP = 2 | 标准果冻颜色 |
| HP = 1 | 浅色果冻，高透明度 |
| HP = 0 | 消散动画，移除 |

**果冻颜色建议**：使用紫色或粉色系，与冰块的蓝色区分。

## 与其他系统的交互

### 炸弹效果

- 炸弹爆炸范围内的果冻会受到伤害
- 单次爆炸只造成 1 点伤害（即使是大范围爆炸）
- 每个受影响的位置独立计算

### Cover 层级

- 如果同一位置同时存在 Cover 和 Jelly：
  - 消除顺序：Cover → Tile → Jelly
  - Cover 存在时，Tile 受保护，Jelly 不受伤害

### AI 评估

- AI 会优先选择能够消除果冻的移动
- 低 HP 的果冻优先级更高（即将被清除）
- 果冻位置的价值权重高于冰块

## 代码位置

| 文件 | 说明 |
|------|------|
| `src/Match3.Core/Models/Enums/GroundType.cs` | 枚举定义 |
| `src/Match3.Core/Models/Grid/Ground.cs` | 数据结构 |
| `src/Match3.Core/Models/Grid/GroundRules.cs` | 默认血量查表（Jelly = 2） |
| `src/Match3.Core/Systems/Layers/GroundSystem.cs` | 消除逻辑 |
| `src/Match3.Core/Events/LayerEvents.cs` | GroundDestroyedEvent |

## 关卡设计建议

- 果冻适合中等难度关卡，需要玩家有意识地多次消除
- 可以与冰块混合使用，创造层次感
- 在关卡目标中加入"清除所有果冻"作为挑战
- 果冻数量不宜过多，避免玩家感到沮丧
- 高层果冻（3-4 层）应谨慎使用，仅用于高难度关卡

## 设计模式参考

| 模式 | 描述 |
|------|------|
| 集中分布 | 果冻集中在棋盘某个区域，需要玩家专注清理 |
| 分散分布 | 果冻散布在棋盘各处，考验玩家的全局意识 |
| 路径阻挡 | 果冻形成"路径"，清除后解锁新的消除可能 |
| 保护目标 | 果冻保护重要位置（如收集物），需要先清除果冻 |

## 相关文档

- [ADR-007: Ground/Cover 层级扩展设计](../04-adr/adr-007-ground-cover-layer.md)
- [Ice 冰块](./ground-ice.md)
- [Honey 蜂蜜](./ground-honey.md)
